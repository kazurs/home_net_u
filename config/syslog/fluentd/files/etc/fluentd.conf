<source>
  @type syslog
  @id syslog_in
  port 5140
  bind 0.0.0.0
  severity_key level
  facility_key facility
  tag rsyslog
  <parse>
    @type syslog
    message_format auto
  </parse>
</source>

<match rsyslog.**>
  @type rewrite_tag_filter
  <rule>
    key host
    pattern /^192\.168\.0\.1$/
    tag syslog.rt.rt
  </rule>
  <rule>
    key host
    pattern /^192\.168\.10\.2$/
    tag syslog.ap.ap
  </rule>
  <rule>
    key host
    pattern /.+/
    tag syslog.all
  </rule>
</match>

<match syslog.rt.rt>
  @type file
  path /fluentd/log/router
  compress gzip
</match>

<match syslog.ap.ap>
  @type file
  path /fluentd/log/ap
  compress gzip
</match>

<match syslog.all>
  @type file
  path /fluentd/log/syslog
  compress gzip
</match>

<match rsyslog.**>
  @type loki
  @id syslog_out
  url "http://localhost:3100"
  extra_labels {"app":"syslog"}
  <label>
    pid
    host
    level
    facility
  </label>
</match>
